

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Python Channel Access Server &mdash; LCLS Lightpath 0.1.0+26.g88c8099 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="LCLS Lightpath 0.1.0+26.g88c8099 documentation" href="index.html"/>
        <link rel="prev" title="BeamPath" href="path.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> LCLS Lightpath
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0+26.g88c8099
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Controlling the beamline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller.html">LightController</a></li>
<li class="toctree-l1"><a class="reference internal" href="path.html">BeamPath</a></li>
</ul>
<p class="caption"><span class="caption-text">User Inteface</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Python Channel Access Server</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LCLS Lightpath</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Python Channel Access Server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/broadcast.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lightpath.ui.broadcast">
<span id="python-channel-access-server"></span><h1>Python Channel Access Server<a class="headerlink" href="#module-lightpath.ui.broadcast" title="Permalink to this headline">¶</a></h1>
<p>The broadcast module contains the tools to report the status of the lightpath
and child devices as EPICS PVs. The instantiation of the Channel Access server
is abstracted away by the <a class="reference internal" href="#lightpath.ui.Broadcaster" title="lightpath.ui.Broadcaster"><code class="xref py py-class docutils literal"><span class="pre">Broadcaster</span></code></a> class, which can either have
devices and paths manually added with <a class="reference internal" href="#lightpath.ui.Broadcaster.add_device" title="lightpath.ui.Broadcaster.add_device"><code class="xref py py-meth docutils literal"><span class="pre">add_device()</span></code></a> or
<a class="reference internal" href="#lightpath.ui.Broadcaster.add_path" title="lightpath.ui.Broadcaster.add_path"><code class="xref py py-meth docutils literal"><span class="pre">add_path()</span></code></a>. If you simply wish to broadcast all the devices within a
<code class="xref py py-class docutils literal"><span class="pre">Controller</span></code> object, just use the classmethod <a class="reference internal" href="#lightpath.ui.Broadcaster.broadcast" title="lightpath.ui.Broadcaster.broadcast"><code class="xref py py-meth docutils literal"><span class="pre">broadcast()</span></code></a> to
create the object. This does all the work of iterating through devices and
paths to assemble a complete IOC.</p>
<p>The produced Channel Access serer is  simple to understand with only four unique classes of PVs
created.</p>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="41%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">PV</th>
<th class="head">Purpose</th>
<th class="head">Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>LCLS:LIGHT:{PATH}</td>
<td>Location of beam along path</td>
<td>int</td>
</tr>
<tr class="row-odd"><td>LCLS:LIGHT:{DEVICE}</td>
<td>State of device</td>
<td>enum</td>
</tr>
<tr class="row-even"><td>LCLS:LIGHT:{DEVICE}.MPS_WARN</td>
<td>MPS faulted, but not exposed</td>
<td>binary</td>
</tr>
<tr class="row-odd"><td>LCLS:LIGHT:{DEVICE}.MPS_TRIP</td>
<td>MPS faulted and exposed</td>
<td>binary</td>
</tr>
<tr class="row-even"><td>LCLS:LIGHT:{DEVICE}:CMD</td>
<td>Command for insert/remove</td>
<td>binary</td>
</tr>
</tbody>
</table>
<p>Each beamline gets a single PV that communicates where the beam is reaching
along the path. Instead of, as in past iterations of the lightpath, creating a
multitude of PVs for each stretch of beamline, this single PV is simply the
index of the first blocking device. For example, if the second device on the
beampath is inserted, the PV for that path will be equal to <code class="docutils literal"><span class="pre">1</span></code>, because only
the zero-th and first sections of beampipe are transmitting the beam. This PV
ignores all devices that are considered passive, devices that may affect the
beam but do not prevent subsequent devices from receiving photons i.e mirrors
and attenuators.</p>
<p>Each device has three PVs added to the database, the first being the current
position; removed, inserted, or unknown. This simply uses the state machine
underlying each <code class="xref py py-class docutils literal"><span class="pre">LightDevice</span></code> to determine the state and update the
broadcast PVs as devices move along the beamline. The <code class="docutils literal"><span class="pre">CMD</span></code> PV exposes the
<code class="xref py py-meth docutils literal"><span class="pre">LightDevice.insert()</span></code> and <code class="xref py py-meth docutils literal"><span class="pre">LightDevice.remove()</span></code> methods, simply send
one of those strings, or the corresponding enums to the PV to instruct the
device to change its’ state. Finally, each device has an <code class="docutils literal"><span class="pre">MPS</span></code> PV, but only
those with an associated <code class="xref py py-class docutils literal"><span class="pre">MPS</span></code> sub-device will have the PV linked to
ophyd subscription service. This allows the UI to use the same widget for each
device regardless of whether it is involved in the MPS system or not.</p>
<dl class="class">
<dt id="lightpath.ui.Broadcaster">
<em class="property">class </em><code class="descclassname">lightpath.ui.</code><code class="descname">Broadcaster</code><a class="reference internal" href="_modules/lightpath/ui/broadcast.html#Broadcaster"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lightpath.ui.Broadcaster" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstraction of pcaspy driver and server</p>
<dl class="attribute">
<dt id="lightpath.ui.broadcast.Broadcaster.server">
<code class="descname">server</code><a class="headerlink" href="#lightpath.ui.broadcast.Broadcaster.server" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">pcaspy.Server</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="lightpath.ui.broadcast.Broadcaster.driver">
<code class="descname">driver</code><a class="headerlink" href="#lightpath.ui.broadcast.Broadcaster.driver" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">pcaspy.Driver</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="lightpath.ui.broadcast.Broadcaster.db">
<code class="descname">db</code><a class="headerlink" href="#lightpath.ui.broadcast.Broadcaster.db" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict</em> – Database of all PVs to be instantiated in the pcaspy server</p>
</dd></dl>

<dl class="attribute">
<dt id="lightpath.ui.broadcast.Broadcaster.cmds">
<code class="descname">cmds</code><a class="headerlink" href="#lightpath.ui.broadcast.Broadcaster.cmds" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict</em> – Mapping of each command PV to the associated device. This is given to
the driver so that it can insert /remove the correct Python object
based on Channel Access inputs</p>
</dd></dl>

<dl class="attribute">
<dt id="lightpath.ui.broadcast.Broadcaster.subs">
<code class="descname">subs</code><a class="headerlink" href="#lightpath.ui.broadcast.Broadcaster.subs" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict</em> – A database of each subscription that updates server PVs based on device
state changes</p>
</dd></dl>

<dl class="method">
<dt id="lightpath.ui.Broadcaster.add_device">
<code class="descname">add_device</code><span class="sig-paren">(</span><em>device</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightpath/ui/broadcast.html#Broadcaster.add_device"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lightpath.ui.Broadcaster.add_device" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the appropriate PVs to the database for a <code class="xref py py-class docutils literal"><span class="pre">LightDevice</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>device</strong> (<code class="xref py py-class docutils literal"><span class="pre">LightDevice</span></code>) – Device to be added to the server database</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lightpath.ui.Broadcaster.add_path">
<code class="descname">add_path</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightpath/ui/broadcast.html#Broadcaster.add_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lightpath.ui.Broadcaster.add_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the apppropriate PVs for a <code class="xref py py-class docutils literal"><span class="pre">Beampath</span></code></p>
<p>:param path <code class="xref py py-class docutils literal"><span class="pre">Beampath</span></code>: Path to be added to the server database</p>
</dd></dl>

<dl class="method">
<dt id="lightpath.ui.Broadcaster.add_subscription">
<code class="descname">add_subscription</code><span class="sig-paren">(</span><em>device</em>, <em>cb</em>, <em>event_type=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightpath/ui/broadcast.html#Broadcaster.add_subscription"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lightpath.ui.Broadcaster.add_subscription" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a subscription to a LightDevice or BeamPath attribute</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>device</strong> (<code class="xref py py-class docutils literal"><span class="pre">LightDevice</span></code> or <code class="xref py py-class docutils literal"><span class="pre">Beampath</span></code>) – </li>
<li><strong>cb</strong> (<em>callable</em>) – Callable function to be run upon receiving an event</li>
<li><strong>event_type</strong> (<em>str</em><em>, </em><em>optional</em>) – Event type to create subscription. If left as None,
it will be the default event_type of the device</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="lightpath.ui.Broadcaster.broadcast">
<em class="property">classmethod </em><code class="descname">broadcast</code><span class="sig-paren">(</span><em>controller</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightpath/ui/broadcast.html#Broadcaster.broadcast"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lightpath.ui.Broadcaster.broadcast" title="Permalink to this definition">¶</a></dt>
<dd><p>Broadcast the all the paths contained in a controller</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>controller</strong> (<code class="xref py py-class docutils literal"><span class="pre">Controller</span></code>) – Controller that has paths and devices</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">New Broadcaster with all paths and devices loaded into the database</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#lightpath.ui.Broadcaster" title="lightpath.ui.Broadcaster"><code class="xref py py-class docutils literal"><span class="pre">Broadcaster</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lightpath.ui.Broadcaster.cleanup">
<code class="descname">cleanup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightpath/ui/broadcast.html#Broadcaster.cleanup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lightpath.ui.Broadcaster.cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>Clean out all the internal pcaspy objects</p>
<p>By deleting the associated databases and pcaspy objects, this means
when <a class="reference internal" href="#lightpath.ui.Broadcaster.run" title="lightpath.ui.Broadcaster.run"><code class="xref py py-meth docutils literal"><span class="pre">run()</span></code></a> is called again, all of this information will be
re-processed, reflecting any added devices and paths. It is worth
noting that this does not clear the actual pcaspy database, this needs
to be done manually.</p>
</dd></dl>

<dl class="attribute">
<dt id="lightpath.ui.Broadcaster.is_running">
<code class="descname">is_running</code><a class="headerlink" href="#lightpath.ui.Broadcaster.is_running" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether the ServerThread is actively running</p>
</dd></dl>

<dl class="method">
<dt id="lightpath.ui.Broadcaster.register_cmd">
<code class="descname">register_cmd</code><span class="sig-paren">(</span><em>cmd</em>, <em>device</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightpath/ui/broadcast.html#Broadcaster.register_cmd"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lightpath.ui.Broadcaster.register_cmd" title="Permalink to this definition">¶</a></dt>
<dd><p>Map a command to a device control PV</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>cmd</strong> (<em>string</em>) – PV name of command</li>
<li><strong>device</strong> (<code class="xref py py-class docutils literal"><span class="pre">LightDevice</span></code>) – Associated device to insert or remove based on received Channel
Access data</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lightpath.ui.Broadcaster.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightpath/ui/broadcast.html#Broadcaster.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lightpath.ui.Broadcaster.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the the internal pcaspy server</p>
<p>If not already created, this also spawns a new ServerThread, Server and
Driver. However, if the server has already been run, it will simply
restart the stored copy of the server. This means that in order for the
server to reflect any changes to the <a class="reference internal" href="#lightpath.ui.broadcast.Broadcaster.db" title="lightpath.ui.broadcast.Broadcaster.db"><code class="xref py py-attr docutils literal"><span class="pre">db</span></code></a>, <a class="reference internal" href="#lightpath.ui.Broadcaster.cleanup" title="lightpath.ui.Broadcaster.cleanup"><code class="xref py py-meth docutils literal"><span class="pre">cleanup()</span></code></a>
should be called before running again.</p>
</dd></dl>

<dl class="method">
<dt id="lightpath.ui.Broadcaster.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightpath/ui/broadcast.html#Broadcaster.stop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lightpath.ui.Broadcaster.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop the internal pcaspy server</p>
</dd></dl>

</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="path.html" class="btn btn-neutral" title="BeamPath" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, SLAC National Accelerator Laboratory.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0+26.g88c8099',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>