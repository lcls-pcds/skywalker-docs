

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Conventions &mdash; Happi Deck 0.5.0+29.g5c49979 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Happi Deck 0.5.0+29.g5c49979 documentation" href="index.html"/>
        <link rel="next" title="Using the Client" href="client.html"/>
        <link rel="prev" title="HAPPI - Heuristic Access to Positions of Photon Instruments" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Happi Deck
          

          
          </a>

          
            
            
              <div class="version">
                0.5.0+29.g5c49979
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Conventions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-device-attributes">Basic Device Attributes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#name">name</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prefix">prefix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beamline">beamline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#z">z</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stand">stand</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-screen">main_screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#embedded-screen">embedded_screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#macros">macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system">system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parent">parent</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#specific-device-attributes">Specific Device Attributes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mps">mps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#veto">veto</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data">data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#destinations">destinations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#states">states</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Using the Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop.html">Creating New Device Types</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="client_api.html">Client API</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">Supported Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Device Containers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Happi Deck</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Conventions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/conventions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="conventions">
<span id="convention-label"></span><h1>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h1>
<p>In order for the database to be as easy to parse as possible we need to
establish conventions on how information is entered. Please read through this
before entering any information into the database.</p>
<div class="section" id="basic-device-attributes">
<h2>Basic Device Attributes<a class="headerlink" href="#basic-device-attributes" title="Permalink to this headline">¶</a></h2>
<p>These are fields that are common to all device</p>
<div class="section" id="name">
<h3>name<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h3>
<p>This is simply a short name we can use to refer to the device.</p>
</div>
<div class="section" id="prefix">
<h3>prefix<a class="headerlink" href="#prefix" title="Permalink to this headline">¶</a></h3>
<p>This should be the prefix for all of the PVs contained within the device. It does
not matter if this is an invalid record by itself. Each Device Container will
have it’s own convention for base PV. See <a class="reference internal" href="containers.html#containers"><span class="std std-ref">Containers</span></a>.</p>
</div>
<div class="section" id="beamline">
<h3>beamline<a class="headerlink" href="#beamline" title="Permalink to this headline">¶</a></h3>
<p>Beamline refers to a single segment of the full path with no branching paths.
Paths may only branch between beamlines. As a convention, we are adopting the
following beamline names for the branching paths:</p>
<div class="figure" id="id1">
<img alt="_images/LCLS.png" src="_images/LCLS.png" />
<p class="caption"><span class="caption-text">Drawing of LCLS beamline layout</span></p>
</div>
<p>Note that this naming scheme will necessarily have to change for lcls 2.</p>
</div>
<div class="section" id="z">
<h3>z<a class="headerlink" href="#z" title="Permalink to this headline">¶</a></h3>
<p>Position of the device on the z-axis in the lcls coordinates.</p>
</div>
<div class="section" id="stand">
<h3>stand<a class="headerlink" href="#stand" title="Permalink to this headline">¶</a></h3>
<p>Acronym for the stand the device is associated with, such as DIA or DG1.
Devices with the same stand and beamline can be grouped together.</p>
</div>
<div class="section" id="main-screen">
<h3>main_screen<a class="headerlink" href="#main-screen" title="Permalink to this headline">¶</a></h3>
<p>Path to a control screen for this device.</p>
</div>
<div class="section" id="embedded-screen">
<h3>embedded_screen<a class="headerlink" href="#embedded-screen" title="Permalink to this headline">¶</a></h3>
<p>Path to an embeddable control screen for this device.</p>
</div>
<div class="section" id="macros">
<h3>macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h3>
<p>Most screens will require a set of macros to be provided at launch time. In
order to prevent information being duplicated in this macro string and other
EntryInfo, this can be given as a <code class="docutils literal"><span class="pre">jinja2</span></code> template. This may sound
intimidating, but in practice it is very simple. Let us look at an example for
a basic camera, who has a nice EDL screen that takes a <code class="docutils literal"><span class="pre">CAM</span></code> and
an <code class="docutils literal"><span class="pre">EVR</span></code> macro substitution. Now every time we change the EVR trigger for
this camera, we want to make sure we only need to change this in one place, so
lets make a template that pulls the information from the Container itself. The
below example creates a new container, adds a new macro templates then
performs a quick test.</p>
<p>The main thing to note is the use of keywords found within the repeated
brackets. When this string is loaded as a <code class="docutils literal"><span class="pre">Template</span></code>, we can easily
substitute our EntryInfo in place of these brackets.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">happi</span>

<span class="go">#Create a new container</span>
<span class="gp">In [2]: </span><span class="k">class</span> <span class="nc">Camera</span><span class="p">(</span><span class="n">happi</span><span class="o">.</span><span class="n">Device</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="n">evr</span> <span class="o">=</span> <span class="n">happi</span><span class="o">.</span><span class="n">EntryInfo</span><span class="p">(</span><span class="s1">&#39;EVR Trigger for Camera&#39;</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="go">#Instantiate</span>
<span class="gp">In [3]: </span><span class="n">cam</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Opal&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;BASE:CAM:PV&#39;</span><span class="p">,</span>
<span class="gp">   ...: </span>             <span class="n">beamline</span><span class="o">=</span><span class="s1">&#39;TST&#39;</span><span class="p">,</span> <span class="n">evr</span><span class="o">=</span><span class="s1">&#39;EVR:TRIG:PV&#39;</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="go">#Link our EDL screens</span>
<span class="gp">In [4]: </span><span class="n">cam</span><span class="o">.</span><span class="n">main_screen</span> <span class="o">=</span> <span class="s1">&#39;my_screens/camera.edl&#39;</span>

<span class="go">#Add our macros template</span>
<span class="gp">In [5]: </span><span class="n">cam</span><span class="o">.</span><span class="n">macros</span> <span class="o">=</span> <span class="s1">&#39;CAM={{prefix}}, EVR={{evr}}&#39;</span>
</pre></div>
</div>
<p>That is all the neccesary information you need to provide, other scripts that
utilize the information will do something similar to the script below to
substitute device information into our template</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span>

<span class="go">#Create new template</span>
<span class="gp">In [7]: </span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>

<span class="go">#Render our template given the device information</span>
<span class="gp">In [8]: </span><span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">cam</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="n">evr</span><span class="o">=</span><span class="n">cam</span><span class="o">.</span><span class="n">evr</span><span class="p">)</span>
<span class="gh">Out[8]: </span><span class="go">&#39;CAM=BASE:CAM:PV, EVR=EVR:TRIG:PV&#39;</span>
</pre></div>
</div>
<p>A succinct script exists in the <code class="docutils literal"><span class="pre">examples</span></code> section of the module that
substitutes and launches the associated EDM screen provided the device name.</p>
</div>
<div class="section" id="system">
<h3>system<a class="headerlink" href="#system" title="Permalink to this headline">¶</a></h3>
<p>System the device is associated with, e.g. vacuum, timing, etc.</p>
</div>
<div class="section" id="parent">
<h3>parent<a class="headerlink" href="#parent" title="Permalink to this headline">¶</a></h3>
<p>If this device is a component of another, this should be the name of the full
device.</p>
</div>
</div>
<div class="section" id="specific-device-attributes">
<h2>Specific Device Attributes<a class="headerlink" href="#specific-device-attributes" title="Permalink to this headline">¶</a></h2>
<p>Devices or classes of devices can have additional attributes.</p>
<div class="section" id="mps">
<h3>mps<a class="headerlink" href="#mps" title="Permalink to this headline">¶</a></h3>
<p>The mps PV associated with an mps device.</p>
</div>
<div class="section" id="veto">
<h3>veto<a class="headerlink" href="#veto" title="Permalink to this headline">¶</a></h3>
<p>A boolean describing whether or not this is a veto device in mps.</p>
</div>
<div class="section" id="data">
<h3>data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<p>A PV that gives us readbacks for diagnostic devices.</p>
</div>
<div class="section" id="destinations">
<h3>destinations<a class="headerlink" href="#destinations" title="Permalink to this headline">¶</a></h3>
<p>A dict mapping from base PV value to beamline destination for a steering
device, such as a mirror or an LODCM crystal.</p>
</div>
<div class="section" id="states">
<h3>states<a class="headerlink" href="#states" title="Permalink to this headline">¶</a></h3>
<p>An additional PV or multiple additional PVs that represent states records that
are important to the device. This is included when one prefix PV is not
sufficient.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="client.html" class="btn btn-neutral float-right" title="Using the Client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="HAPPI - Heuristic Access to Positions of Photon Instruments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, SLAC National Accelerator Laboratory.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.5.0+29.g5c49979',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>